# NGINX Configuration for fileshare-cli
# This configuration serves files uploaded via the CLI
# and provides directory listing for easy browsing

server {
    listen 9090;
    server_name localhost;

    # Root directory where files will be uploaded
    # This should match the upload directory configured in the CLI
    root /root/fileshare;

    # Default charset
    charset utf-8;

    # Increase max upload size (for reverse proxy if needed)
    client_max_body_size 10G;

    # Enable directory listing with autoindex
    location / {
        autoindex on;
        autoindex_exact_size off;  # Show sizes in MB/GB instead of bytes
        autoindex_localtime on;    # Show local time instead of GMT
        autoindex_format html;     # HTML format for browser viewing

        # Try to serve file directly, then directory index, then 404
        try_files $uri $uri/ =404;

        # Optional: Enable basic auth for password protection
        # Uncomment these lines and create .htpasswd file to enable
        # auth_basic "File Share Access";
        # auth_basic_user_file /etc/nginx/.htpasswd;

        # CORS headers (optional, if accessing from web apps)
        add_header Access-Control-Allow-Origin * always;
        add_header Access-Control-Allow-Methods "GET, OPTIONS" always;
        add_header Access-Control-Allow-Headers "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range" always;

        # Cache control
        add_header Cache-Control "public, max-age=3600";
    }

    # Deny access to hidden files (except .well-known)
    location ~ /\.(?!well-known) {
        deny all;
    }

    # Error pages
    error_page 404 /404.html;
    error_page 500 502 503 504 /50x.html;

    # Logging
    access_log /var/log/nginx/fileshare_access.log;
    error_log /var/log/nginx/fileshare_error.log;

    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;

    # Prevent directory traversal
    location ~ \.\. {
        deny all;
    }
}
